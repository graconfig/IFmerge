# 使用指南

## 快速开始

### 1. 安装依赖

```bash
pip install -r requirements.txt
```

### 2. 准备输入文件

将需要处理的Excel文件放入 `input` 文件夹中。工具会自动处理该文件夹中的所有Excel文件（.xlsx和.xls格式）。

### 3. 运行工具

使用默认设置（输入文件夹：`input`，输出文件夹：`output`，阈值：80%）：

```bash
python -m ebs_merger
```

### 4. 查看结果

处理完成后，结果文件会保存在 `output` 文件夹中，文件名格式为：`グルーピング結果_原文件名.xlsx`

每个输出文件包含以下信息：
- 每个IF的分组ID
- 是否需要合并（マージ要否）
- 合并后的IF名称
- 分组根据（相似度信息）

## 高级用法

### 指定输入输出文件夹

```bash
python -m ebs_merger --input-dir "你的输入文件夹" --output-dir "你的输出文件夹"
```

### 调整相似度阈值

```bash
# 使用85%的阈值
python -m ebs_merger --threshold 0.85

# 使用90%的阈值（更严格）
python -m ebs_merger --threshold 0.9

# 使用70%的阈值（更宽松）
python -m ebs_merger --threshold 0.7
```

### 查看帮助信息

```bash
python -m ebs_merger --help
```

## 批量处理说明

### 文件夹结构

```
项目根目录/
├── input/              # 输入文件夹（放置待处理的Excel文件）
│   ├── 文件1.xlsx
│   ├── 文件2.xlsx
│   └── ...
├── output/             # 输出文件夹（自动生成结果文件）
│   ├── グルーピング結果_文件1.xlsx
│   ├── グルーピング結果_文件2.xlsx
│   └── ...
└── ebs_merger/         # 程序源代码
```

### 批量处理特性

- ✅ 自动扫描input文件夹中的所有Excel文件
- ✅ 支持.xlsx和.xls格式
- ✅ 自动跳过临时文件（以~$开头的文件）
- ✅ 为每个输入文件生成独立的输出文件
- ✅ 显示每个文件的处理进度和结果
- ✅ 统计批量处理的总体情况

## 输出说明

### 输出文件列

1. **No.** - 序号
2. **文書管理番号** - 文档管理编号
3. **IF名** - 接口名称
4. **項目数** - 项目数量
5. **IF概要** - 接口概要（预留）
6. **代表項目名** - 代表项目名
7. **グルーピングID** - 分组ID（格式：G001, G002, G003...）
8. **マージ要否** - 是否需要合并（○：需要合并，×：不需要合并）
9. **グルーピング後のIF名** - 合并后的IF名称
10. **グルーピングの根拠** - 分组依据（相似度信息）

### 分组规则

- 两个IF的相似度 ≥ 阈值时，会被分配到同一组
- 相似度 = 共同的(EBSテーブルID, 項目ID)对数量 / min(IF1的对数量, IF2的对数量)
- 使用Union-Find算法确保传递性（如果A与B相似，B与C相似，则A、B、C在同一组）

## 示例

### 示例1：批量处理多个文件

```bash
# 将多个Excel文件放入input文件夹
# 然后运行
python -m ebs_merger
```

输出：
```
============================================================
开始批量分析EBS设计书...
============================================================
输入文件夹：input
输出文件夹：output
相似度阈值：80%

发现 3 个Excel文件

[1/3] 处理文件: 文件1.xlsx
------------------------------------------------------------
  正在读取Excel文件...
  成功读取 32 行数据
  正在分组IF...
  发现 4 个IF
  正在计算相似度...
  发现 1 对相似IF
  正在生成分组...
  生成 3 个分组
  正在写入输出文件...
  输出文件已保存：グルーピング結果_文件1.xlsx
  总IF数：4 | 需要合并：2 | 独立：2 | 分组数：3
✓ 处理成功

[2/3] 处理文件: 文件2.xlsx
...

============================================================
批量处理完成！
============================================================
总文件数：3
成功处理：3
处理失败：0
输出文件夹：output
============================================================
```

### 示例2：调整阈值批量处理

```bash
python -m ebs_merger --threshold 0.9
```

使用更严格的阈值（90%），可能会减少合并的IF数量。

## 故障排除

### 错误：在input文件夹中未找到Excel文件

确保：
1. input文件夹存在
2. 文件夹中有.xlsx或.xls格式的Excel文件
3. 文件不是临时文件（不以~$开头）

### 错误：Excel文件缺少必需列

确保输入文件包含以下列：
- No.
- 文書管理番号
- IF名
- EBSテーブル名
- EBSテーブルID
- 項目ID
- 項目名
- 桁数

### 错误：无法写入输出文件

确保：
1. output文件夹有写入权限
2. 输出文件没有被其他程序打开
3. 磁盘空间充足

### 部分文件处理失败

工具会继续处理其他文件，并在最后显示失败的文件数量。检查错误消息以了解失败原因。
